{"uid":"54e3971f685a2f0","name":"Негативный тест: Частичное обновление с невалидными данными","fullName":"api.tests.test_booking#test_partial_update_with_bad_data_negative","historyId":"387864450e1e5e86f8115b17b0aa4bee","time":{"start":1756135076763,"stop":1756135076809,"duration":46},"description":"Проверка, что система возвращает ошибку при отправке некорректных данных.","descriptionHtml":"<p>Проверка, что система возвращает ошибку при отправке некорректных данных.</p>\n","status":"failed","statusMessage":"AssertionError: Ожидался статус-код 400, но получен 200. Тело ответа: {\"firstname\":\"Automation\",\"lastname\":\"Tester\",\"totalprice\":1000,\"depositpaid\":true,\"bookingdates\":{\"checkin\":\"2025-09-01\",\"checkout\":\"2025-09-10\"},\"additionalneeds\":\"Allure Report\"}","statusTrace":"booking_endpoint = <api.endpoints.booking_endpoint.BookingEndpoint object at 0x7f1adc118890>\nbooking_id = 3556, auth_token = '5a5a9abc5b65160'\npayload = {'depositpaid': 'not-a-boolean'}, expected_status_code = 400\ntest_id = 'invalid_depositpaid_type'\n\n    @allure_annotations(\n        title=\"Негативный тест: Частичное обновление с невалидными данными\",\n        story=\"Обновление бронирования\",\n        description=\"Проверка, что система возвращает ошибку при отправке некорректных данных.\",\n        severity=allure.severity_level.CRITICAL,\n        tags=['API', 'Regression']\n    )\n    @pytest.mark.parametrize(\n        \"payload, expected_status_code, test_id\",\n        booking_payloads.invalid_patch_data(),\n        ids=booking_payloads.invalid_patch_data_ids()\n    )\n    def test_partial_update_with_bad_data_negative(booking_endpoint, booking_id, auth_token, payload, expected_status_code,\n                                                   test_id) -> None:\n        booking_endpoint.partial_update_booking(booking_id, payload, auth_token)\n>       booking_endpoint.check_status_code_is_(expected_status_code)\n\napi/tests/test_booking.py:142: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <api.endpoints.booking_endpoint.BookingEndpoint object at 0x7f1adc118890>\nexpected_code = 400\n\n    @allure.step(\"Проверка: Статус-код ответа равен {expected_code}\")\n    def check_status_code_is_(self, expected_code: int) -> None:\n        actual_code = self.response.status_code\n>       assert actual_code == expected_code, \\\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n            f\"Ожидался статус-код {expected_code}, но получен {actual_code}. Тело ответа: {self.response.text}\"\nE       AssertionError: Ожидался статус-код 400, но получен 200. Тело ответа: {\"firstname\":\"Automation\",\"lastname\":\"Tester\",\"totalprice\":1000,\"depositpaid\":true,\"bookingdates\":{\"checkin\":\"2025-09-01\",\"checkout\":\"2025-09-10\"},\"additionalneeds\":\"Allure Report\"}\n\napi/endpoints/base_api.py:14: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"booking_endpoint","time":{"start":1756135075645,"stop":1756135075645,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"auth_endpoint","time":{"start":1756135075928,"stop":1756135075928,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"auth_token","time":{"start":1756135075928,"stop":1756135075970,"duration":42},"status":"passed","steps":[{"name":"API: Получение токена авторизации","time":{"start":1756135075928,"stop":1756135075970,"duration":42},"status":"passed","steps":[],"attachments":[{"uid":"d0eb4db095093c2b","name":"Auth Response","source":"d0eb4db095093c2b.json","type":"application/json","size":34}],"parameters":[{"name":"payload","value":"{'username': 'admin', 'password': 'password123'}"}],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":1,"hasContent":true},{"name":"booking_id","time":{"start":1756135076722,"stop":1756135076762,"duration":40},"status":"passed","steps":[{"name":"API-действие: Создание нового бронирования","time":{"start":1756135076722,"stop":1756135076762,"duration":40},"status":"passed","steps":[{"name":"Проверка: Тело ответа валидируется по схеме BookingResponse","time":{"start":1756135076762,"stop":1756135076762,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"attachments":[{"uid":"db157ce6b637ba5d","name":"Request Payload","source":"db157ce6b637ba5d.json","type":"application/json","size":195},{"uid":"c0e56cf809237a5a","name":"Response","source":"c0e56cf809237a5a.json","type":"application/json","size":325}],"parameters":[{"name":"payload","value":"{'firstname': 'Automation', 'lastname': 'Tester', 'totalprice': 1000, 'depositpaid': True, 'bookingdates': {'checkin': '2025-09-01', 'checkout': '2025-09-10'}, 'additionalneeds': 'Allure Report'}"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":2,"hasContent":true},{"name":"Проверка: Статус-код ответа равен 200","time":{"start":1756135076762,"stop":1756135076762,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[{"name":"expected_code","value":"200"}],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":true}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":3,"attachmentsCount":2,"hasContent":true}],"testStage":{"description":"Проверка, что система возвращает ошибку при отправке некорректных данных.","status":"failed","statusMessage":"AssertionError: Ожидался статус-код 400, но получен 200. Тело ответа: {\"firstname\":\"Automation\",\"lastname\":\"Tester\",\"totalprice\":1000,\"depositpaid\":true,\"bookingdates\":{\"checkin\":\"2025-09-01\",\"checkout\":\"2025-09-10\"},\"additionalneeds\":\"Allure Report\"}","statusTrace":"booking_endpoint = <api.endpoints.booking_endpoint.BookingEndpoint object at 0x7f1adc118890>\nbooking_id = 3556, auth_token = '5a5a9abc5b65160'\npayload = {'depositpaid': 'not-a-boolean'}, expected_status_code = 400\ntest_id = 'invalid_depositpaid_type'\n\n    @allure_annotations(\n        title=\"Негативный тест: Частичное обновление с невалидными данными\",\n        story=\"Обновление бронирования\",\n        description=\"Проверка, что система возвращает ошибку при отправке некорректных данных.\",\n        severity=allure.severity_level.CRITICAL,\n        tags=['API', 'Regression']\n    )\n    @pytest.mark.parametrize(\n        \"payload, expected_status_code, test_id\",\n        booking_payloads.invalid_patch_data(),\n        ids=booking_payloads.invalid_patch_data_ids()\n    )\n    def test_partial_update_with_bad_data_negative(booking_endpoint, booking_id, auth_token, payload, expected_status_code,\n                                                   test_id) -> None:\n        booking_endpoint.partial_update_booking(booking_id, payload, auth_token)\n>       booking_endpoint.check_status_code_is_(expected_status_code)\n\napi/tests/test_booking.py:142: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <api.endpoints.booking_endpoint.BookingEndpoint object at 0x7f1adc118890>\nexpected_code = 400\n\n    @allure.step(\"Проверка: Статус-код ответа равен {expected_code}\")\n    def check_status_code_is_(self, expected_code: int) -> None:\n        actual_code = self.response.status_code\n>       assert actual_code == expected_code, \\\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n            f\"Ожидался статус-код {expected_code}, но получен {actual_code}. Тело ответа: {self.response.text}\"\nE       AssertionError: Ожидался статус-код 400, но получен 200. Тело ответа: {\"firstname\":\"Automation\",\"lastname\":\"Tester\",\"totalprice\":1000,\"depositpaid\":true,\"bookingdates\":{\"checkin\":\"2025-09-01\",\"checkout\":\"2025-09-10\"},\"additionalneeds\":\"Allure Report\"}\n\napi/endpoints/base_api.py:14: AssertionError","steps":[{"name":"API-действие: Частичное обновление бронирования по ID '3556'","time":{"start":1756135076763,"stop":1756135076808,"duration":45},"status":"passed","steps":[{"name":"Проверка: Тело ответа валидируется по схеме Booking","time":{"start":1756135076808,"stop":1756135076808,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"attachments":[{"uid":"f9623cbf1cb70d8b","name":"Request Payload","source":"f9623cbf1cb70d8b.json","type":"application/json","size":32},{"uid":"b0bfce2ebdd38e6d","name":"Response","source":"b0bfce2ebdd38e6d.json","type":"application/json","size":243}],"parameters":[{"name":"booking_id","value":"3556"},{"name":"payload","value":"{'depositpaid': 'not-a-boolean'}"},{"name":"token","value":"'5a5a9abc5b65160'"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":2,"hasContent":true},{"name":"Проверка: Статус-код ответа равен 400","time":{"start":1756135076808,"stop":1756135076808,"duration":0},"status":"failed","statusMessage":"AssertionError: Ожидался статус-код 400, но получен 200. Тело ответа: {\"firstname\":\"Automation\",\"lastname\":\"Tester\",\"totalprice\":1000,\"depositpaid\":true,\"bookingdates\":{\"checkin\":\"2025-09-01\",\"checkout\":\"2025-09-10\"},\"additionalneeds\":\"Allure Report\"}\n","statusTrace":"  File \"/usr/local/lib/python3.12/dist-packages/allure_commons/_allure.py\", line 202, in impl\n    return func(*a, **kw)\n           ^^^^^^^^^^^^^^\n  File \"/app/api/endpoints/base_api.py\", line 14, in check_status_code_is_\n    assert actual_code == expected_code, \\\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n","steps":[],"attachments":[],"parameters":[{"name":"expected_code","value":"400"}],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":3,"attachmentsCount":2,"hasContent":true},"afterStages":[{"name":"booking_id::0","time":{"start":1756135076813,"stop":1756135076857,"duration":44},"status":"passed","steps":[{"name":"API-действие: Удаление бронирования по ID '3556'","time":{"start":1756135076813,"stop":1756135076857,"duration":44},"status":"passed","steps":[],"attachments":[{"uid":"63fe34af2e1a53df","name":"Response","source":"63fe34af2e1a53df.txt","type":"text/plain","size":7}],"parameters":[{"name":"booking_id","value":"3556"},{"name":"token","value":"'5a5a9abc5b65160'"}],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true},{"name":"Проверка: Статус-код ответа равен 201","time":{"start":1756135076857,"stop":1756135076857,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[{"name":"expected_code","value":"201"}],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":true}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":2,"attachmentsCount":1,"hasContent":true}],"labels":[{"name":"story","value":"Обновление бронирования"},{"name":"severity","value":"critical"},{"name":"feature","value":"API Тесты"},{"name":"tag","value":"api"},{"name":"tag","value":"regression"},{"name":"parentSuite","value":"api.tests"},{"name":"suite","value":"test_booking"},{"name":"host","value":"75345b9cce0e"},{"name":"thread","value":"7-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"api.tests.test_booking"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"expected_status_code","value":"400"},{"name":"payload","value":"{'depositpaid': 'not-a-boolean'}"},{"name":"test_id","value":"'invalid_depositpaid_type'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"critical","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":["regression","api"]},"source":"54e3971f685a2f0.json","parameterValues":["400","{'depositpaid': 'not-a-boolean'}","'invalid_depositpaid_type'"]}